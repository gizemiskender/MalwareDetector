import pickle
from celery import Celery


def read_from_file(file_path):
    o = None
    try:
        with open(file_path, 'rb') as f:
            o = pickle.load(f)
    except:
        print '[!] File load error {}'.format(file_path)
    return o


def make_celery(a):
    celery = Celery(a.import_name, broker=a.config['CELERY_BROKER_URL'])
    celery.conf.update(a.config)
    TaskBase = celery.Task

    class ContextTask(TaskBase):
        abstract = True

        def __call__(self, *args, **kwargs):
            with a.app_context():
                return TaskBase.__call__(self, *args, **kwargs)
    celery.Task = ContextTask
    return celery