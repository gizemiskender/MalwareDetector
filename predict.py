import pickle
import sys
from pymongo import MongoClient, DESCENDING
from constants import DB_NAME, ALG_TYPES
from core import extract_features, create_vector_single

if __name__ == '__main__':
    if len(sys.argv) > 1:
        file_path = sys.argv[1]
        features = extract_features(file_path)
        feature_vector = create_vector_single(features)
        client = MongoClient()
        db = client[DB_NAME]
        entry = db.train.find().sort([('timestamp', -1)])[0]
        train_data = entry['train_data'].decode('base64')
        clf = pickle.loads(train_data)
        result = clf.predict(feature_vector)
        if result == 1:
            print 'This application is MALWARE'
        else:
            print 'This application is GOODWARE'
    else:
        print '[+] Usage: python {} <file_path>'.format(__file__)
